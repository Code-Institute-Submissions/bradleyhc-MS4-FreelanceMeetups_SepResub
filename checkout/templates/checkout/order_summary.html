{% extends 'base.html' %}
{% load static %}

{% block content %}
this is the summary page
{{package.name}}
{{package_cost}}
{{stripe_customer}}
{{stripe_price_id}}


<!-- Payment form -->
<form action="" id="payment_form" method="POST"> {% csrf_token %}
    <fieldset>
        <legend>Payment here</legend>
        <div id="card_element"></div>
            <div id="card_errors">
        </div>
        <input type="submit" name="" id="submit_button">Click me</input>
    </fieldset>
</form>

<script>

$(document).ready(function(){
    
csrf = '{{ csrf_token }}'
fetch('/checkout/create_subscription', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': csrf,
    },
    body: JSON.stringify({
    //   'data': 'data'
        'priceId': ("{{stripe_price_id}}"),
      'customerId': "{{stripe_customer}}",
    })
})
.then(response => {
    // console.log(response.json())
        return response.json() //Convert response to JSON
  })
  .then(data => {
      console.log("receiving", data.clientSecret)
      submitCard(data.clientSecret)
  //Perform actions with the response data from the view
  })
})
</script>

{% endblock %}


{% block post_JS %}
    {{ block.super }}
    {{ stripe_public_key|json_script:"id_stripe_public_key" }}
    {{ stripe_client_secret|json_script:"id_stripe_client_secret" }}
    <script src="{% static 'checkout/js/stripe_elements.js' %}"></script>
{% endblock %}