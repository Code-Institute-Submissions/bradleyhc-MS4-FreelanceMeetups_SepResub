{% extends 'includes/base.html' %}
{% load static %}

{% block content %}
this is the summary page
{{package.name}}
{{package_cost}}
{{stripe_customer}}
{{stripe_price_id}}


{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</li>
        {% endfor %}
</ul>
{% endif %}
<section class="light-page screen-height section-with-padding">
    <div class="nav-top-padding"></div>
    <div class="container-fluid w-100 m-auto py-5 px-0 centered-col-large-page">
        <h1 class="header-underline-after">Select Your Subscription</h1>



        <!-- Payment form -->
        <form action="" id="payment_form" method="POST"> {% csrf_token %}
            <fieldset>
                <legend>Payment here</legend>
                <div id="card_element"></div>
                <div id="card_errors">
                </div>
                <input type="submit" name="" id="submit_button">Click me</input>
            </fieldset>
        </form>
    </div>
</section>

<script>

    // $(document).ready(function () {
    //     const csrftoken = Cookies.get('csrftoken');
        
    //     fetch('/checkout/create_subscription', {
    //         method: 'POST',
    //         headers: {
    //             'Content-Type': 'application/json',
    //             'X-CSRFToken': csrftoken,
    //         },
    //         body: {
    //             'priceId': ("{{stripe_price_id}}"),
    //             'customerId': "{{stripe_customer}}",
    //         },
    //     })
    //         .then(response => {
    //             // console.log(response.json())
    //             return response.json() //Convert response to JSON
    //         })
    //         .then(data => {
    //             console.log("receiving", data.clientSecret)
    //             submitCard(data.clientSecret)
    //             //Perform actions with the response data from the view
    //         })
    // })
</script>

{% endblock %}


{% block post_JS %}
{{ block.super }}
{{ stripe_public_key|json_script:"id_stripe_public_key" }}
{{ stripe_client_secret|json_script:"id_stripe_client_secret" }}
<script src="{% static 'checkout/js/checkout.js' %}"></script>
{% endblock %}