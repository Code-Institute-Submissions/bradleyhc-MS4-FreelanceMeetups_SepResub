{% extends 'includes/base.html' %}
{% load static %}
{% load tz %}

{% block head_title %}Events{% endblock %}

{% block post_CSS %}
<link rel="stylesheet" href="{% static 'events/css/events.css' %}">
{% endblock %}

{% block content %}
<section class="light-page screen-height section-with-padding">
    <div class="nav-top-padding"></div>
    <div class="container-fluid w-100 m-auto py-5 px-0 centered-col-large-page">
        <h1 class="header-underline-after">Find Freelancer Meetups</h1>
        <div class="search-row py-5">
            <div class="card search-box-card muted">
                <h2>Filter your search</h2>
                <form action="{% url 'all_users' %}" id="user_search_form" method="POST">{%csrf_token%}
                    <div class="input-row d-flex justify-content-between mt-3">
                        <div class="fieldset">
                            <label for="user_search" class="mb-3">By Keyword</label>
                            <input type="text" name="user_search" id="user_search"
                                placeholder="Search by name, location, skill, description">
                        </div>
                        <div class="fieldset" id="industry_search">
                            <label for="industry" class="mb-3">By Industry</label>
                            <div id="ind_select_profile_edit"></div>
                        </div>
                    </div>
                    <div class="d-flex search-button-wrapper justify-content-between flex-wrap">
                        <button type="submit" class="btn primary-btn large">Filter Results</button>
                        <a href="{% url 'all_users' %}" class="btn primary-btn-outline-color">Clear Results</a>
                    </div>
                </form>
            </div>
        </div>


        <div id="search_results" class="page-results flex-wrap">
            {% for event in events %}
            <div class="card event-card muted">
                <div class="event-header-img">
                    <img class="" src="/media/{{event.header_image}}" alt="{{event.title}} - header image"
                        onload="specImageOrientation(this);">
                    <span class="card-title-overlay"></span>
                    <h3 class="event-card-title">{{event.title}}</h3>
                </div>
                <div class="d-flex flex-wrap">
                    <!-- TODO remove default testing input -->
                    <div class="event-details-mast p-0 m-auto text-center">
                        <span class="ind-pill">{{event.industry}}</span>
                        <p class="d-inline">{{event.location}}</p>
                        <p class="event-datetime d-block mt-2 text-center">{{event.start_datetime|date:"D d M Y gA"}}
                            ({{event.timezone}})</p>
                        {% if event.timezone != this_user.timezone%}
                        <span class="timezone-warning"><em>This event doesn't occur in your timezone!</em></span>
                        {% endif %}
                    </div>
                </div>
                <hr>
                <div class="event-details-bottom">
                    <p class="event-skills">{{event.description}}</p>
                </div>

                <div class="event-card-buttons">
                    <button class="view-attendees-btn btn primary-btn px-3 py-1 m-1"
                        onclick="cancel_friend('{{user.pk}}')" data-bs-toggle="modal"
                        data-bs-target="#view_event_{{event.pk}}" value="{{event.pk}}"><i class="fas fa-eye"></i>View
                        Attendees</button>
                    <button class="register-btn btn primary-btn px-3 py-1 m-1" onclick="cancel_friend('{{user.pk}}')"
                        value="{{event.pk}}"><i class="fas fa-clipboard"></i>Register</button>
                    <button class="remove-reg-btn btn primary-btn px-3 py-1 m-1" onclick="add_friend('   {{user.pk}}')"
                        value="{{event.pk}}"><i class="fas fa-check"></i>Registered</button>


                    <button class="btn primary-btn-outline-color px-3 py-1 m-1">Cancel Registration</button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="fixed-40"></div>

    <!-- View Event Modal START -->
    {%for event in events%}
    <div class="modal event-view fade" id="view_event_{{event.pk}}" tabindex="-1" role="dialog"
        aria-labelledby="view_event_{{event.pk}}" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <span class="d-flex" data-bs-dismiss="modal" aria-label="Close"><i
                            class="fas fa-times ml-auto "></i></span>
                    <div class="event-card muted m-0 pt-0">
                        <div class="d-flex flex-wrap flex-column flex-sm-row">
                            <div class="prf-img-preview mx-0">
                                <img class="prf-img-preview portrait-img" src="/media/{{new_connection.profile_image}}"
                                    alt="Bradley Cooney's profile image" onload="specImageOrientation(this);">
                            </div>


                        </div>
                        <hr>
                        <div class="event-details-bottom">
                            <!-- List registered attendees -->
                            <div class="pending-requests-to-me">
                                {% for reg in event.registrants.all %}
                                <div class="attendee-item-item flex-row flex-wrap" value="{{new_connection.pk}}">
                                    <div
                                        class="img-and-details-mast d-flex col-xl-8 col-lg-12 col-12 flex-column flex-sm-row">
                                        <div class="thumbnail-wrapper prf-img-preview-wrapper m-auto">
                                            <img class="prf-img-preview" src="/media/{{reg.profile_image}}"
                                                alt="{{new_connection.first_name}} {{new_connection.last_name}}'s' profile image"
                                                onload="specImageOrientation(this);">
                                        </div>
                                        <div class="new-req-details d-flex flex-column text-xl-start 
                    text-lg-start text-sm-start text-center">
                                            <p>{{reg.first_name}} {{reg.last_name}}
                                            </p>
                                            <p>{{reg.job_role}}
                                                <span class="ind-pill">{{reg.industry}}</span>
                                            </p>
                                        </div>
                                    </div>

                                    <!-- Action buttons -->
                                    <div class="action-btns col-xl-4">
                                        <button class="accept-conn-btn btn primary-btn attendee-action-btn"
                                            onclick="accept_friend('{{new_connection.pk}}')"
                                            value="{{new_connection.pk}}" data-toggle="tooltip">
                                            <i class="fas fa-check"></i>
                                            <span class="tooltip-top">Accept the request</span>
                                        </button>
                                        <button class="view-conn-btn btn primary-btn attendee-action-btn"
                                            data-bs-toggle="modal" data-bs-target="#view_user_{{new_connection.pk}}"
                                            value="{{new_connection.pk}}">
                                            <i class="fas fa-eye"></i>
                                            <span class="tooltip-top">View the user</span>
                                        </button>
                                        <button class="decline-conn-btn btn primary-btn attendee-action-btn warning"
                                            onclick="decline_friend('{{new_connection.pk}}')"
                                            value="{{new_connection.pk}}">
                                            <i class="fas fa-times"></i>
                                            <span class="tooltip-top">Decline the request</span>
                                        </button>
                                    </div>

                                </div>

                                {% endfor %}
                            </div>
                            <p class="event-skills">
                                {{ new_connection.skills }}
                            </p>
                            <p class="pt-3">{{new_connection.description}}</p>
                        </div>
                        <div class="action-btns d-flex">
                        </div>
                    </div>
                </div>
                <div class="modal-footer flex-row">
                    <button class="accept-conn-btn btn primary-btn attendee-action-btn w-45"
                        onclick="accept_friend('{{new_connection.pk}}')" value="{{new_connection.pk}}"
                        data-toggle="tooltip" data-bs-dismiss="modal" aria-label="Close">
                        <i class="fas fa-check"></i><span class="mx-2">Accept the request</span>
                    </button>
                    <button class="decline-conn-btn btn primary-btn attendee-action-btn w-45"
                        onclick="decline_friend('{{new_connection.pk}}')" value="{{new_connection.pk}}"
                        data-bs-dismiss="modal" aria-label="Close">
                        <i class="fas fa-times"></i><span class="mx-2">Decline the request</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    <!-- View Event Modal END -->

</section>

{{ industries|json_script:"all_inds" }}
<script src="{% static 'users/js/options_multiselect.js' %}" type="text/javascript"></script>
<script src="{% static 'events/js/events.js' %}" type="text/javascript"></script>


{% endblock %}